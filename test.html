<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Routine App Mockup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* マーキーアニメーション */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: scroll-left 15s linear infinite; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        
        /* スクロールバー非表示 (タブ用) */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* タップ時のハイライト制御 */
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen flex flex-col font-sans">

    <header class="bg-white shadow-sm z-10 flex-none">
        <div class="flex justify-between items-center px-4 py-3 border-b border-slate-100">
            <div>
                <span id="header-date" class="text-xl font-bold tracking-tight">Loading...</span>
            </div>
            <div id="work-indicator" class="hidden flex items-center bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-xs font-bold">
                <i class="fa-solid fa-briefcase mr-1"></i> 出社日
            </div>
        </div>
        
        <div class="bg-slate-50 text-slate-500 text-sm py-1 border-b border-slate-200 marquee-container">
            <div id="marquee-text" class="marquee-text">今日も一日頑張りましょう</div>
        </div>
    </header>

    <main id="main-content" class="flex-1 overflow-y-auto p-4 space-y-6">
        </main>

    <footer class="bg-white border-t border-slate-200 flex-none pb-safe">
        <div id="tab-container" class="flex overflow-x-auto no-scrollbar py-2 px-2 gap-2">
            </div>
    </footer>

    <script>
        // --- データ定義 (JSON構造) ---
        const appData = {
            settings: {
                workDays: [1, 2, 4], // 月(1), 火(2), 木(4)
                messages: ["焦らず、一歩ずつ進もう。", "深呼吸してリラックス。", "小さい積み重ねが大事。", "今日も良い一日を！"]
            },
            tabs: [
                {
                    id: "daily", name: "毎日", isSystemLocked: true,
                    subGroups: [
                        {
                            title: "朝のルーチン",
                            tasks: [
                                { id: "t1", title: "白湯を飲む", isCompleted: false },
                                { id: "t2", title: "観葉植物の水やり", isCompleted: false },
                                { id: "t3", title: "5分間瞑想", isCompleted: false }
                            ]
                        },
                        {
                            title: "夜のルーチン",
                            tasks: [
                                { id: "t4", title: "翌日の服を用意", isCompleted: false },
                                { id: "t5", title: "ストレッチ", isCompleted: false }
                            ]
                        }
                    ]
                },
                {
                    id: "work", name: "出社", isSystemLocked: true,
                    subGroups: [
                        {
                            title: "始業アクション",
                            tasks: [
                                { 
                                    id: "w1", title: "勤怠打刻(開始)", isCompleted: false,
                                    action: { type: "url", label: "打刻", value: "https://google.com" }
                                },
                                { 
                                    id: "w2", title: "メールチェック", isCompleted: false,
                                    action: { type: "shortcut", label: "メール起動", value: "OpenMailApp" }
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "holiday", name: "休日", isSystemLocked: true,
                    subGroups: [
                        { title: "家事", tasks: [{ id: "h1", title: "掃除機をかける", isCompleted: false }] }
                    ]
                },
                {
                    id: "others", name: "その他", isSystemLocked: false,
                    subGroups: [
                        {
                            title: "買い物リスト",
                            tasks: [
                                { id: "o1", title: "牛乳", isCompleted: false },
                                { id: "o2", title: "卵", isCompleted: false }
                            ]
                        }
                    ]
                }
            ]
        };

        // --- 状態管理 ---
        let activeTabId = "daily"; // 初期タブ

        // --- ロジック関数 ---

        // 日付・曜日・出社日判定
        function renderHeader() {
            const now = new Date();
            const days = ["日", "月", "火", "水", "木", "金", "土"];
            const dayOfWeek = now.getDay();
            
            // 日付表示
            document.getElementById('header-date').innerText = 
                `${now.getMonth() + 1}月${now.getDate()}日 (${days[dayOfWeek]})`;

            // 出社日インジケーター
            const indicator = document.getElementById('work-indicator');
            if (appData.settings.workDays.includes(dayOfWeek)) {
                indicator.classList.remove('hidden');
            } else {
                indicator.classList.add('hidden');
            }

            // マーキーメッセージ
            const randomMsg = appData.settings.messages[Math.floor(Math.random() * appData.settings.messages.length)];
            document.getElementById('marquee-text').innerText = randomMsg;
        }

        // パステルカラー生成ロジック (決定的)
        function getPastelColor(index) {
            // 黄金角(137.5度)で色相をずらす
            const hue = Math.floor((index * 137.5) % 360); 
            // 彩度70%, 輝度90% (淡い色)
            return `hsl(${hue}, 70%, 90%)`;
        }

        // タブ切り替え
        function switchTab(tabId) {
            activeTabId = tabId;
            renderFooter();
            renderMain();
        }

        // フッター描画
        function renderFooter() {
            const container = document.getElementById('tab-container');
            container.innerHTML = '';

            appData.tabs.forEach(tab => {
                const btn = document.createElement('button');
                const isActive = tab.id === activeTabId;
                
                // Tailwindクラス
                const baseClass = "px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors";
                const activeClass = "bg-slate-800 text-white shadow-md";
                const inactiveClass = "bg-slate-100 text-slate-500 hover:bg-slate-200";

                btn.className = `${baseClass} ${isActive ? activeClass : inactiveClass}`;
                btn.innerText = tab.name;
                btn.onclick = () => switchTab(tab.id);
                container.appendChild(btn);
            });
        }

        // メインコンテンツ描画
        function renderMain() {
            const container = document.getElementById('main-content');
            container.innerHTML = '';

            const currentTab = appData.tabs.find(t => t.id === activeTabId);
            if (!currentTab) return;

            currentTab.subGroups.forEach((group, index) => {
                // サブグループカード
                const card = document.createElement('div');
                // 色生成
                const bgColor = getPastelColor(index);
                card.style.backgroundColor = bgColor;
                card.className = "rounded-2xl p-4 shadow-sm";

                // グループタイトル
                const title = document.createElement('h3');
                title.className = "text-slate-700 font-bold mb-3 text-sm opacity-80 flex justify-between";
                title.innerHTML = `<span>${group.title}</span>`;
                
                // 編集可能タブなら編集アイコンを表示(ダミー)
                if (!currentTab.isSystemLocked) {
                    title.innerHTML += `<i class="fa-solid fa-pen text-slate-400 text-xs"></i>`;
                }
                card.appendChild(title);

                // タスクリスト
                const list = document.createElement('div');
                list.className = "flex flex-col gap-2";

                group.tasks.forEach(task => {
                    const row = document.createElement('div');
                    row.className = `bg-white/60 rounded-xl p-3 flex items-center justify-between transition-all ${task.isCompleted ? 'opacity-50' : ''}`;
                    
                    // チェックボックス + テキスト
                    const leftCol = document.createElement('div');
                    leftCol.className = "flex items-center gap-3 flex-1 cursor-pointer";
                    leftCol.onclick = () => toggleTask(task.id);

                    const checkboxIcon = task.isCompleted ? "fa-circle-check text-slate-400" : "fa-regular fa-circle text-slate-400";
                    const textDecor = task.isCompleted ? "line-through text-slate-400" : "text-slate-700 font-medium";

                    leftCol.innerHTML = `
                        <i class="fa-solid ${checkboxIcon} text-xl transition-colors"></i>
                        <span class="${textDecor} select-none">${task.title}</span>
                    `;

                    row.appendChild(leftCol);

                    // アクションボタン (存在する場合)
                    if (task.action) {
                        const btn = document.createElement('button');
                        btn.className = "ml-2 bg-white text-blue-500 border border-blue-100 px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm active:scale-95 transition-transform flex items-center gap-1";
                        const iconClass = task.action.type === 'shortcut' ? 'fa-bolt' : 'fa-arrow-up-right-from-square';
                        
                        btn.innerHTML = `<i class="fa-solid ${iconClass}"></i> ${task.action.label}`;
                        
                        btn.onclick = (e) => {
                            e.stopPropagation(); // 行クリック(完了)を防ぐ
                            runAction(task.action);
                        };
                        row.appendChild(btn);
                    }

                    list.appendChild(row);
                });

                card.appendChild(list);
                container.appendChild(card);
            });
        }

        // タスク完了切り替え
        function toggleTask(taskId) {
            // 全タブ・全グループからタスクを探して更新 (簡易実装)
            appData.tabs.forEach(tab => {
                tab.subGroups.forEach(group => {
                    const task = group.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.isCompleted = !task.isCompleted;
                    }
                });
            });
            renderMain(); // 再描画
        }

        // アクション実行 (ショートカット/URL)
        function runAction(action) {
            if (action.type === 'url') {
                // 実際のWebアプリなら window.open(action.value)
                alert(`Webサイトを開きます: ${action.value}`);
            } else if (action.type === 'shortcut') {
                // 実際のWebアプリなら location.href = shortcuts://...
                const scheme = `shortcuts://run-shortcut?name=${encodeURIComponent(action.value)}`;
                alert(`ショートカット起動を試行:\n${scheme}`);
                // window.location.href = scheme; // 実機用
            }
        }

        // --- 初期化実行 ---
        window.onload = () => {
            renderHeader();
            renderFooter();
            renderMain();
        };

    </script>
</body>
</html>